<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大龍峒保安宮藥籤</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        :root {
            scroll-behavior: smooth;
        }
        nav {
            font-family: monospace;
            line-height: 1.15rem;
            overflow-x: hidden;
            text-align: right;
        }
        article {
            margin: 1rem auto;
            border-bottom: 2px solid gray;
        }
        h1 a, h2 a {
            text-decoration: none;
            color: initial;
        }
        .bi {
            font-size: 1.25rem;
        }

        @media (orientation: portrait) {
            h1 {
                position: fixed;
                top: 0;
                background: linear-gradient(#fff, #fff 20%, #ffffff80 90%, #ffffff00 100%);
                padding-bottom: .3em;
            }
            nav {
                margin-top: 3rem;
            }
        }
    </style>
    <script>
        function zerofill(num, length) {
            while(num.toString().length < length) num = "0" + num;
            return num;
        }

        function scrollTo(hash) {
            hash = hash.substring(hash.indexOf("#"));
            if(hash.length <= 1) {
                location.hash = "#";
                window.scroll(0, 0);
                return;
            }
            const target = document.querySelector(`a[name="${hash.substring(1)}"]`);
            if(!target) return;
            location.hash = hash;
            target.scrollIntoView({behavior: "auto", block: "center", inline: "center"});
        }

        document.addEventListener("DOMContentLoaded", async () => {
            const text = await fetch("./prescription-baoan.txt").then(res => res.text());
            const recipes = text.replace(/ /g, "").split(/第\d+首/);
            const main = document.querySelector("main");
            const nav = document.querySelector("nav");

            recipes.forEach((recipe, index) => {
                if(!index) return;
                const article = document.createElement("article");

                const header = document.createElement("h2");
                const h2 = document.createElement("h2");
                const a = document.createElement("a");
                a.name = index;
                a.href = `#${index}`;
                const linkBtn = document.createElement("i");
                linkBtn.classList.add("bi", "bi-link-45deg");
                a.append(`第 ${index} 首 `, linkBtn);
                h2.append(a);

                const upBtn = document.createElement("a");
                upBtn.classList.add("bi", "bi-arrow-up");
                upBtn.href = "#";
                upBtn.title = "回到頁首";

                header.classList.add("d-flex", "justify-content-between");
                header.append(h2, upBtn);
                article.appendChild(header);

                const lines = recipe.trim().split(/\r?\n\r?/).reduce((acc, cur) => {
                    cur = cur.trim();
                    if(acc.length && !acc[acc.length - 1].endsWith("。"))
                        acc[acc.length - 1] += cur;
                    else acc.push(cur);
                    return acc;
                }, []);
                lines.forEach(line => {
                    const p = document.createElement("p");
                    p.append(line);
                    article.append(p);
                });
                main.appendChild(article);
            });

            for(let i = 1; i < recipes.length; ++i) {
                const a = document.createElement("a");
                a.href = `#${i}`;
                a.textContent = zerofill(i, 3);
                nav.append(a, " ");
                if(!(i % 10)) nav.append(document.createElement("br"));
            }

            document.querySelectorAll("a[href]").forEach(a => {
                a.addEventListener("click", event => {
                    const href = event.target.href;
                    if(href.indexOf("#") === -1) return;
                    scrollTo(href);
                    event.preventDefault();
                });
            });

            scrollTo(location.hash);
        });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="m-0 w-100"><a href="#">大龍峒保安宮藥籤</a></h1>
            <nav></nav>
        </header>
        <main></main>
        <footer class="d-flex justify-content-between">
            <div>
                <span>注意：</span>
                如有使用需求仍應由醫藥專業者評估。
            </div>
            <div class="secondary small text-nowrap mx-1">
                註解：<a href="https://www.facebook.com/%E7%94%B2%E9%AC%BC%E7%94%B2%E6%80%AA3141592-104795118795119/">甲鬼甲怪</a>
                <br>
                網頁：<a href="https://linktr.ee/kong0107">阿空</a>
            </div>
        </footer>
    </div>
</body>
</html>
