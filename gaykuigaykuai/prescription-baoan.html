<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大龍峒保安宮藥籤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <style>
        :root {
            scroll-behavior: smooth;
        }
    </style>
    <script>
        function zerofill(num, length) {
            while(num.toString().length < length) num = "0" + num;
            return num;
        }

        document.addEventListener("DOMContentLoaded", async () => {
            const text = await fetch("./prescription-baoan.txt").then(res => res.text());
            const recipes = text.replace(/ /).split(/第\d+首/);
            const main = document.querySelector("main");
            const nav = document.querySelector("nav");

            recipes.forEach((recipe, index) => {
                if(!index) return;
                const article = document.createElement("article");
                const header = document.createElement("h2");
                const a = document.createElement("a");
                a.name = index;
                a.append(`第 ${index} 首`);
                header.append(a);
                article.appendChild(header);

                const lines = recipe.trim().split(/\r?\n\r?/).reduce((acc, cur) => {
                    cur = cur.trim();
                    if(acc.length && !acc[acc.length - 1].endsWith("。"))
                        acc[acc.length - 1] += cur;
                    else acc.push(cur);
                    return acc;
                }, []);
                lines.forEach(line => {
                    const p = document.createElement("p");
                    p.append(line);
                    article.append(p);
                });
                main.appendChild(article);
            });

            for(let i = 1; i < recipes.length; ++i) {
                const a = document.createElement("a");
                a.href = `#${i}`;
                a.textContent = zerofill(i, 3);
                nav.append(a, " ");
                if(!(i % 10)) nav.append(document.createElement("br"));
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>大龍峒保安宮藥籤</h1>
            <nav></nav>
        </header>
        <main></main>
        <footer></footer>
    </div>
</body>
</html>