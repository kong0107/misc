<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="utf-8">
<title>Movable Popup: fixed and absolute position</title>
<style type="text/css">
.popup {
    border: 1px solid gray;
    padding: 0 1em;
    width: 200px;
    height: 200px;
    background: linear-gradient(70deg, #f00, pink);
}
.popup-press-to-move {
    border: 1px solid green;
    font-weight: bold;
    cursor: grab;
    margin: .5em;
    padding: .2em .5em;
}

.popup-fixed {
    position: fixed;
    top: 400px;
    left: 500px;
}
.popup-absolute {
    position: absolute;
    top: 100px;
    left: 200px;
}
</style>
</head>
<body>
<div class="popup popup-fixed">
    <header class="popup-press-to-move">press and drag to move</header>
    Fixed elements are positioned relative to their own initial containing block established by the viewport.
</div>
<div class="popup popup-absolute">
    <header class="popup-press-to-move">press and drag to move</header>
    Absolute-positioned elements are positioned relative to its closest positioned ancestor.
</div>
<div style="width: 2000px; height: 1000px; border: 1px solid blue;">
    <p>This implement is NOT about `<a href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API">draggable</a>`.</p>
    <p>Scroll to other position to see the difference between `fixed` and `absolute` position. And note that codes fit to each situation are different.</p>
    <p>Listen `mousedown` event on button elements. However, `mousemove` and `mouseup` shall be listened on the containing block.</p>
</div>
<script>
    document.querySelectorAll(".popup").forEach(popup => {
        const button = popup.querySelector(".popup-press-to-move");
        if(!button) return;

        const isAbs = popup.classList.contains("popup-absolute");
        let dragging = false, offsetX, offsetY;
        button.addEventListener("mousedown", event => {
            dragging = true;
            const rect = popup.getBoundingClientRect();
            offsetX = event.pageX - rect.left - isAbs * window.scrollX;
            offsetY = event.pageY - rect.top - isAbs * window.scrollY;
        });
        document.addEventListener("mousemove", event => {
            if(!dragging) return;
            const left = event.pageX - offsetX;
            const top = event.pageY - offsetY;
            const cs = getComputedStyle(popup);
            popup.style.left = `calc(${left}px - ${cs.marginLeft})`;
            popup.style.top = `calc(${top}px - ${cs.marginTop})`;
        });
        document.addEventListener("mouseup", () => {
            dragging = false;
        });
    });
</script>
</body>
</html>
