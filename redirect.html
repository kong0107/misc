<!DOCTYPE HTML>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="kong0107">
<title>轉址 (Redirect)</title>
<meta property="og:title" content="轉址 (Redirect)">
<meta property="og:type" content="article">
<meta property="og:image" content="https://kong0107.github.io/images/og_image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:description" content="自製帶有警告的轉址網頁 Make your own warning page to target webpage">
<style type="text/css">
dd {
	margin-bottom: 1.5em;
}
dt {
	border-top: 1px solid #ccc;
	padding: 0.2em;
}
ul {
	margin: 0;
	padding: 0;
	list-style-type: none;
}
body {
	line-height: 150%;
}
body > footer {
	margin-top: 4em;
	color: #888;
}
</style>
<script type="text/javascript">
// if(location.protocol === 'http:') location.replace('https' + location.href.substring(4));

function $(s) { return document.querySelector(s); }
function str_rot13(str) {
	return str.replace(/[a-z]/gi, function(c) {
		return String.fromCharCode(c.charCodeAt(0) + (c.toLowerCase() < 'n' ? 13 : -13));
	});
}

const s = document.location.search;
const wms = {
	obscenity : {zh: '色情猥褻', en: 'sex and/or obscenity'},
	blood     : {zh: '暴力血腥', en: 'violence and/or blood'},
	trypo     : {zh: '密集孔洞', en: 'clustered holes'},
	restricted: {zh: '不適合未達法定年齡者瀏覽', en: 'disallowed for those below legal age'}
};

let url;
let wm_zh = '', wm_en = '';
let hasUrl = false;
let auto = false;
let parse_str_rot13 = false;

document.addEventListener('DOMContentLoaded', () => {
	if(s.length > 1) {
		const pairs = s.substr(1).split('&');
		for(let i = 0; i < pairs.length; ++i) {
			const pair = pairs[i].split('=');
			if(!pair[0].length) continue;
			const p = pair[0];
			const v = pair[1];
			if(!v) continue;
			switch(p) {
				case 'auto': {
					if(v != '0' && v != 'false') auto = true;
					break;
				}
				case 'url': {
					if(v.length < 10) break;
					hasUrl = true;
					/// 網址含有非 ASCII 字元時，遇到如 Facebook 的轉址連結，還原時會變亂碼，故不宜一概用 unescape 。
					url = v.replace(
						/%[\dA-F]{2}/g,
						str => (parseInt(str.substr(1,2), 16) > 0x7f) ? str : unescape(str)
					);
					break;
				}
				case 'encode': {
					parse_str_rot13 = true;
					break;
				}
				case 'obscenity':
				case 'blood':
				case 'trypo':
				case 'restricted': {
					if(wm_zh.length) {
						wm_zh += '、';
						wm_en += ' and';
					}
					else wm_en = 'containing';
					wm_zh += wms[p].zh;
					wm_en += ' ' + wms[p].en;
					break;
				}
				case 'warning': {
					if(wm_zh.length) {
						wm_zh += '、';
						wm_en += ' and other inappropriate stuff';
					}
					wm_zh += decodeURI(v.trim());
					break;
				}
				default:
					console.warn('Unknown parameter `' + p + '` is listed as ' + v);
			}
		}
	}
	if(hasUrl) {
		if(wm_zh.length) {
			$('#warning-zh').textContent = wm_zh;
			$('#warning-en').textContent = wm_en;

			if(parse_str_rot13) url = str_rot13(url);
			if(auto) location.replace(url);
			const a = $('#url');
			a.href = url;
			a.textContent = url;
			$('#confirm').addEventListener('submit', () => {
				location.replace(url);
				return false;
			});
			$('#input').style.display = 'none';
		}
	}
	else {
		$('#confirm').style.display = 'none';
		$('#input').addEventListener('submit', e => {
			const es = e.target.elements;
			if(es.url.value.length < 10) {
				alert('網址太短 (The URL is too short.)');
				return false;
			}
			if(es.encode.checked)
				es.url.value = str_rot13(es.url.value);
		});
	}
});
</script>
</head>
<body>
<form id="confirm">
	下述目標網址被認定包含<span id="warning-zh">不適宜所有人觀賞</span>的內容，確定要前往？
	<br>
	The destination URL below has been warned <span id="warning-en">not appropriate for everyone</span>. Are you sure to go forward?
	<br>
	<a id="url"></a>
	<br>
	<input type="submit" value="前往 (Go Forward)">
	<hr>
	<a id="create" href="redirect.html">建立警告頁 (Create a warning page)</a>
</form>
<form id="input">
	<h1>自製帶有警告的轉址網頁<br>Make your own warning page to target webpage</h1>
	<dl>
		<dt>輸入網址<br>Enter the URL</dt>
		<dd><input type="text" name="url"></dd>
		<dt>選擇警告類型<br>Select warning type</dt>
		<dd>
			<ul>
				<li><label><input type="checkbox" name="obscenity" checked="checked">色情猥褻 (sex and/or obscenity)</label></li>
				<li><label><input type="checkbox" name="blood">暴力血腥 (violence and/or blood)</label></li>
				<li><label><input type="checkbox" name="trypo">密集孔洞 (clustered holes)</label></li>
				<li><label><input type="checkbox" name="restricted" checked="checked">未達法定年齡者不得瀏覽 (disallowed for those below legal age)</label></li>
				<li><label>其他：<input type="text" name="warning"></label></li>
			</ul>
		</dd>
		<dt>其他選項<br>Other Choices</dt>
		<dd>
			<ul>
				<li>
					<label style="display: flex;">
						<div><input type="checkbox" name="encode" value="str_rot13"></div>
						<div>
							將網址編碼（以避開某些網站的過濾機制）
							<br>
							Encode the URL (to prevent from being banned)
						</div>
					</label>
				</li>
			</ul>
		</dd>
		<dt>按下送出後，請複製頁面網址。<br>Submit and then you can copy the link in the address bar.</dt>
		<dd><input type="submit" value="送出 (Submit)"></dd>
	</dl>
</form>
<footer>
	免責聲明：本網站與作者，對於您將被引導前往的網頁，不負任何責任，亦不做任何保證。
	<br>
	Disclaimer: The author of this site/page is NOT responsible for what is in the target webpage.
</footer>
</body>
</html>
